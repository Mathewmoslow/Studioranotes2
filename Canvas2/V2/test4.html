<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summer 2025 Complete Schedule Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .header {
            background-color: #fff;
            border-bottom: 1px solid #ddd;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 400;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            gap: 20px;
        }
        
        .left-panel {
            flex: 1;
            min-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .right-panel {
            flex: 2;
        }
        
        /* Module Cards */
        .module-cards {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .module-card {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .module-header {
            padding: 15px;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .obgyn-header { background-color: #2196F3; }
        .adulthealth-header { background-color: #4CAF50; }
        .nclex-header { background-color: #9C27B0; }
        .geronto-header { background-color: #FF9800; }
        .sample-header { background-color: #607D8B; }
        
        .module-title {
            font-weight: 500;
            font-size: 16px;
        }
        
        .module-status {
            background: rgba(255,255,255,0.3);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .collapse-icon {
            font-size: 20px;
            transition: transform 0.3s;
        }
        
        .module-card.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }
        
        .module-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .module-card.collapsed .module-content {
            max-height: 0;
        }
        
        .module-info {
            padding: 15px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            color: #666;
        }
        
        .key-topics {
            padding: 15px;
            background-color: #f9f9f9;
        }
        
        .key-topics h4 {
            font-size: 14px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .key-topics p {
            font-size: 13px;
            line-height: 1.5;
            color: #666;
        }
        
        .assignments {
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .assignment-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .assignment-item:last-child {
            border-bottom: none;
        }
        
        .assignment-checkbox {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            cursor: pointer;
        }
        
        .assignment-text {
            flex: 1;
            font-size: 14px;
        }
        
        .assignment-date {
            font-size: 12px;
            color: #999;
            margin-left: 10px;
        }
        
        .class-info {
            padding: 15px;
            background-color: #f0f7ff;
            font-size: 14px;
        }
        
        .class-info strong {
            display: block;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 4px;
            background-color: #e0e0e0;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .action-buttons {
            padding: 15px;
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background-color: #2196F3;
            color: white;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        /* Week/Course Selectors */
        .selectors {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
            position: sticky;
            top: 0;
            background: #f5f5f5;
            padding: 10px 0;
            z-index: 10;
        }
        
        .selector-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .selector-group label {
            font-weight: 500;
        }
        
        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
        }
        
        /* Calendar */
        .calendar-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .calendar-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        
        .tab.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        
        .calendar-view {
            display: none;
        }
        
        .calendar-view.active {
            display: block;
        }
        
        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        
        /* Calendar Event Colors */
        .fc-event {
            border: none;
            padding: 2px 4px;
            margin: 1px 0;
            font-size: 11px;
        }
        
        /* Week View List */
        .week-schedule {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .day-section {
            margin-bottom: 25px;
        }
        
        .day-header {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eee;
        }
        
        .time-slot {
            display: flex;
            gap: 15px;
            padding: 8px 0;
            align-items: center;
        }
        
        .time {
            width: 140px;
            font-size: 14px;
            color: #666;
        }
        
        .event {
            flex: 1;
            padding: 8px 12px;
            border-radius: 4px;
            color: white;
            font-size: 14px;
        }
        
        /* Event type colors */
        .lecture { background-color: #2196F3; }
        .clinical { background-color: #4CAF50; }
        .exam { background-color: #f44336; }
        .quiz { background-color: #FF9800; }
        .assignment { background-color: #9C27B0; }
        .prep { background-color: #00BCD4; }
        .simulation { background-color: #8BC34A; }
        .study { 
            background-color: #000000; 
            color: #ffffff !important;
            border: 1px solid #333;
        }
        
        /* Study blocks */
        .fc-event.study {
            background-color: #000000 !important;
            color: #ffffff !important;
            border: 1px solid #333 !important;
        }
        
        /* Debug console */
        #debug-console {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #222;
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            height: 100px;
            overflow-y: auto;
            z-index: 10000;
            border-top: 3px solid #0f0;
            display: none;
        }
        
        .debug-message {
            margin: 2px 0;
            padding: 2px 5px;
        }
        
        .debug-error {
            color: #f00;
            background: rgba(255,0,0,0.1);
        }
        
        /* Adaptive scheduler controls */
        .scheduler-controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .scheduler-controls h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .scheduler-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .scheduler-button:hover {
            background: #1976D2;
        }
        
        /* Calendar specific fixes */
        #calendar-month, #calendar-week {
            min-height: 600px;
        }
        
        /* Scheduler Settings */
        .scheduler-settings {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .scheduler-settings .setting-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .scheduler-settings label {
            font-size: 14px;
            font-weight: 500;
        }
        
        .scheduler-settings input {
            width: 60px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        #scheduler-status {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        
        .progress-text {
            padding: 10px 15px;
            text-align: center;
            font-size: 14px;
            color: #666;
        }
        
        /* Document Parser Styles */
        .parser-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .parser-content {
            position: relative;
            background: white;
            margin: 50px auto;
            width: 90%;
            max-width: 800px;
            height: 80vh;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
        }
        
        .parser-header {
            padding: 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .parser-body {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 20px;
            overflow: hidden;
        }
        
        .parser-input {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .parser-output {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .parser-textarea {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            resize: none;
        }
        
        .parser-results {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow-y: auto;
            background: #f9f9f9;
        }
        
        .parser-footer {
            padding: 20px;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .import-button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .import-button:hover {
            background: #45a049;
        }
        
        .error-message {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .success-message {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            color: #2e7d32;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .parsed-item {
            background: white;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .parsed-item h4 {
            margin-bottom: 5px;
        }
        
        .template-select {
            width: 200px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .welcome-card {
            padding: 40px;
            text-align: center;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="debug-console">
        <div class="debug-message">Debug console initialized...</div>
    </div>
    
    <div class="header">
        <h1>Summer 2025 Nursing Schedule</h1>
        <div>
            <button class="btn" onclick="showParser()">Import Documents</button>
            <button class="btn" onclick="exportData()">Export Data</button>
            <button class="btn" onclick="showImportDialog()">Import Data</button>
            <span style="margin-left: 20px;">Current Week: <span id="current-week">Week 1</span></span>
        </div>
    </div>
    
    <div class="container">
        <div class="left-panel">
            <h2 style="margin-bottom: 15px;">Week <span id="week-number">1</span> Module Assignments</h2>
            <div class="selectors">
                <div class="selector-group">
                    <label>Jump to Week:</label>
                    <select id="week-selector" onchange="changeWeek(this.value)">
                        <option value="1" selected>Week 1</option>
                        <option value="2">Week 2</option>
                        <option value="3">Week 3</option>
                        <option value="4">Week 4</option>
                        <option value="5">Week 5</option>
                        <option value="6">Week 6</option>
                        <option value="7">Week 7</option>
                        <option value="8">Week 8</option>
                        <option value="9">Week 9</option>
                        <option value="10">Week 10</option>
                        <option value="11">Week 11</option>
                        <option value="12">Week 12</option>
                        <option value="13">Week 13</option>
                        <option value="14">Week 14</option>
                    </select>
                </div>
                <div class="selector-group">
                    <label>Select Course:</label>
                    <select id="course-selector" onchange="filterByCourse(this.value)">
                        <option value="all">All Courses</option>
                        <option value="obgyn">OB/GYN</option>
                        <option value="adulthealth">Adult Health</option>
                        <option value="nclex">NCLEX</option>
                        <option value="geronto">Gerontology</option>
                    </select>
                </div>
            </div>
            
            <div class="module-cards" id="module-cards">
                <!-- Module cards will be dynamically generated here -->
            </div>
        </div>
        
        <div class="right-panel">
            <div class="scheduler-controls">
                <h3>Adaptive Scheduler</h3>
                <div class="scheduler-settings">
                    <div class="setting-group">
                        <label>Daily Max Hours:</label>
                        <input type="number" id="daily-max" value="6" min="1" max="12">
                    </div>
                    <div class="setting-group">
                        <label>Weekend Max Hours:</label>
                        <input type="number" id="weekend-max" value="4" min="1" max="8">
                    </div>
                    <div class="setting-group">
                        <label>Block Duration:</label>
                        <input type="number" id="block-duration" value="1.5" min="0.5" max="3" step="0.5">
                    </div>
                </div>
                <button class="scheduler-button" onclick="generateStudySchedule()">Generate Study Schedule</button>
                <button class="scheduler-button" onclick="clearStudyBlocks()">Clear Study Blocks</button>
                <div id="scheduler-status"></div>
            </div>
            
            <div class="calendar-container">
                <div class="calendar-tabs">
                    <div class="tab active" data-view="month">Month</div>
                    <div class="tab" data-view="week">Week</div>
                    <div class="tab" data-view="list">List</div>
                </div>
                
                <div id="month-view" class="calendar-view active">
                    <div id="calendar-month"></div>
                </div>
                
                <div id="week-view" class="calendar-view">
                    <div id="calendar-week"></div>
                </div>
                
                <div id="list-view" class="calendar-view">
                    <div class="week-schedule" id="week-schedule">
                        <!-- Week schedule will be populated here -->
                    </div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color lecture"></div>
                        <span>Lectures</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color clinical"></div>
                        <span>Clinical</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color exam"></div>
                        <span>Exams</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color quiz"></div>
                        <span>Quizzes</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color prep"></div>
                        <span>Prep Work</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color assignment"></div>
                        <span>Assignments</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color simulation"></div>
                        <span>Simulation</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color study"></div>
                        <span>Study Time</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Document Parser Modal -->
    <div id="parser-modal" class="parser-modal">
        <div class="parser-content">
            <div class="parser-header">
                <h2>Import Course Documents</h2>
                <button class="btn" onclick="hideParser()">Close</button>
            </div>
            
            <div class="parser-body">
                <div class="parser-input">
                    <h3>Input Document</h3>
                    <div style="margin: 10px 0;">
                        <select class="template-select" id="template-select" onchange="loadTemplate()">
                            <option value="">Select template...</option>
                            <option value="canvas">Canvas Copy/Paste</option>
                            <option value="syllabus">Syllabus Format</option>
                            <option value="outline">Course Outline</option>
                            <option value="json">Pre-formatted JSON</option>
                            <option value="custom">Custom Format</option>
                        </select>
                        <button class="btn" onclick="parseDocument()">Parse Document</button>
                    </div>
                    <textarea id="document-input" class="parser-textarea" 
                             placeholder="Paste your course materials here..."></textarea>
                </div>
                
                <div class="parser-output">
                    <h3>Parsed Results</h3>
                    <div id="parser-messages"></div>
                    <div id="parser-results" class="parser-results">
                        <!-- Parsed results will appear here -->
                    </div>
                </div>
            </div>
            
            <div class="parser-footer">
                <button class="btn" onclick="clearParser()">Clear</button>
                <button class="import-button" onclick="importParsedDataFromUI()">Import to Schedule</button>
            </div>
        </div>
    </div>
    
    <!-- Data Import Modal -->
    <div id="import-modal" class="parser-modal">
        <div class="parser-content" style="max-width: 600px; height: auto;">
            <div class="parser-header">
                <h2>Import Schedule Data</h2>
                <button class="btn" onclick="hideImportDialog()">Close</button>
            </div>
            
            <div class="parser-body" style="flex-direction: column;">
                <div style="margin-bottom: 20px;">
                    <h3>Upload Data File</h3>
                    <p>Select a JSON file exported from another device to import your schedule data.</p>
                    <input type="file" id="import-file" accept=".json" style="margin-top: 10px;">
                </div>
                
                <div id="import-preview" style="display: none;">
                    <h3>Preview</h3>
                    <div id="import-preview-content" class="parser-results" style="max-height: 200px;">
                        <!-- Preview content will appear here -->
                    </div>
                </div>
                
                <div id="import-messages"></div>
            </div>
            
            <div class="parser-footer">
                <button class="btn" onclick="clearImportDialog()">Clear</button>
                <button class="import-button" onclick="importDataFile()">Import Data</button>
            </div>
        </div>
    </div>
    
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script>
    // Debug mode
    const DEBUG_MODE = false;
    
    // Global variables - EMPTY STATE
    let debugMessages = [];
    let calendarMonth;
    let calendarWeek;
    let calendarEvents = [];  // Empty array - no hardcoded events
    let studyBlocks = [];
    let currentWeek = 1;
    let completedAssignments = new Set();
    let semesterModules = {};  // Empty object - no hardcoded modules
    let parsedData = null;
    
    // Error handler
    window.addEventListener('error', e => {
        debugCheckpoint('Global error: ' + e.message + ' at ' + e.filename + ':' + e.lineno, true);
    });
    
    // Debug console functionality
    function debugCheckpoint(message, isError = false) {
        const time = new Date().toLocaleTimeString();
        const formattedMessage = `[${time}] ${message}`;
        debugMessages.push({ message: formattedMessage, isError });
        
        // Always log to browser console
        if (isError) {
            console.error(formattedMessage);
        } else {
            console.log(formattedMessage);
        }
        
        // Update debug console if in debug mode
        if (DEBUG_MODE) {
            const debugConsole = document.getElementById('debug-console');
            if (debugConsole) {
                debugConsole.style.display = 'block';
                debugConsole.innerHTML = debugMessages.slice(-10).map(msg => 
                    `<div class="debug-message ${msg.isError ? 'debug-error' : ''}">${msg.message}</div>`
                ).join('');
                debugConsole.scrollTop = debugConsole.scrollHeight;
            }
        } else {
            // Hide debug console if not in debug mode
            const debugConsole = document.getElementById('debug-console');
            if (debugConsole) {
                debugConsole.style.display = 'none';
            }
        }
    }
    
    debugCheckpoint('Initializing application...');
    
    // Document Parser Class - COMPLETE IMPLEMENTATION
    class DocumentParser {
        constructor() {
            this.patterns = {
                date: /(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})|(\w+\s+\d{1,2},?\s+\d{4})|(\d{1,2}\s+\w+\s+\d{4})/gi,
                time: /(\d{1,2}:\d{2}\s*[AaPp][Mm])|(\d{1,2}[AaPp][Mm])/gi,
                module: /module\s*(\d+):?\s*(.+?)(?=module|\n\n|$)/gis,
                assignment: /(?:assignment|quiz|exam|test|project|paper|discussion|reading|chapter|video|lab|clinical)[\s:]*(.+?)(?=\n|$)/gi,
                course: /(?:NURS|NUR|NSG)\s*\d{3,4}[A-Z]?\s*-?\s*(.+?)(?=\n|$)/gi,
                credits: /(\d+)\s*(?:credit|hour)s?/gi
            };
        }
        
        parse(text, template = 'auto') {
            const results = {
                courses: [],
                modules: [],
                assignments: [],
                events: [],
                errors: []
            };
            
            try {
                // Clean the text
                text = this.cleanText(text);
                
                // Auto-detect format if needed
                if (template === 'auto') {
                    template = this.detectFormat(text);
                }
                
                // Parse based on template
                switch (template) {
                    case 'canvas':
                        this.parseCanvas(text, results);
                        break;
                    case 'syllabus':
                        this.parseSyllabus(text, results);
                        break;
                    case 'outline':
                        this.parseCourseOutline(text, results);
                        break;
                    case 'json':
                        this.parseJSON(text, results);
                        break;
                    default:
                        this.parseGeneric(text, results);
                }
                
                // Post-process results
                this.postProcess(results);
                
            } catch (error) {
                results.errors.push(`Parsing error: ${error.message}`);
            }
            
            return results;
        }
        
        cleanText(text) {
            return text
                .replace(/\r\n/g, '\n')
                .replace(/\t/g, '    ')
                .replace(/[^\S\n]+/g, ' ')
                .trim();
        }
        
        detectFormat(text) {
            if (text.includes('Canvas') || text.includes('Modules')) return 'canvas';
            if (text.includes('Syllabus') || text.includes('Course Description')) return 'syllabus';
            if (text.includes('Week') && text.includes('Chapter')) return 'outline';
            if (text.trim().startsWith('{') || text.trim().startsWith('[')) return 'json';
            return 'generic';
        }
        
        parseJSON(text, results) {
            try {
                const jsonData = JSON.parse(text);
                
                // Handle module data
                if (jsonData.modules) {
                    Object.entries(jsonData.modules).forEach(([week, courses]) => {
                        Object.entries(courses).forEach(([courseName, moduleData]) => {
                            results.modules.push({
                                number: parseInt(week),
                                course: courseName,
                                ...moduleData
                            });
                        });
                    });
                }
                
                // Handle calendar events
                if (jsonData.events) {
                    results.events = jsonData.events;
                }
                
            } catch (e) {
                results.errors.push(`JSON parsing error: ${e.message}`);
            }
        }
        
        parseCanvas(text, results) {
            // Parse modules
            const moduleMatches = text.matchAll(this.patterns.module);
            for (const match of moduleMatches) {
                const moduleNum = match[1];
                const moduleTitle = match[2].trim();
                
                const module = {
                    number: parseInt(moduleNum),
                    title: moduleTitle,
                    assignments: []
                };
                
                // Find assignments within this module section
                const moduleSection = match[0];
                const assignmentMatches = moduleSection.matchAll(this.patterns.assignment);
                
                for (const assignMatch of assignmentMatches) {
                    const assignment = this.parseAssignment(assignMatch[0]);
                    if (assignment) {
                        module.assignments.push(assignment);
                    }
                }
                
                results.modules.push(module);
            }
        }
        
        parseSyllabus(text, results) {
            // Similar to canvas but looks for syllabus-specific patterns
            this.parseCanvas(text, results);
        }
        
        parseCourseOutline(text, results) {
            // Similar to canvas but looks for week-based patterns
            this.parseCanvas(text, results);
        }
        
        parseGeneric(text, results) {
            // Try all patterns
            this.parseCanvas(text, results);
        }
        
        parseAssignment(text) {
            const assignment = {
                text: '',
                date: null,
                type: 'assignment',
                hours: 1
            };
            
            // Extract assignment text
            assignment.text = text.replace(this.patterns.assignment, '$1').trim();
            
            // Extract date
            const dateMatch = text.match(this.patterns.date);
            if (dateMatch) {
                assignment.date = this.parseDate(dateMatch[0]);
            }
            
            // Determine type
            if (/quiz|test|exam/i.test(text)) {
                assignment.type = 'quiz';
                assignment.hours = 1.5;
            } else if (/reading|chapter/i.test(text)) {
                assignment.type = 'reading';
                assignment.hours = 2;
            } else if (/video|watch/i.test(text)) {
                assignment.type = 'video';
                assignment.hours = 1;
            } else if (/project|paper/i.test(text)) {
                assignment.type = 'project';
                assignment.hours = 3;
            }
            
            return assignment;
        }
        
        parseDate(dateStr) {
            const now = new Date();
            const year = 2025; // Hardcoded for this semester
            
            // Try different date formats
            const formats = [
                /(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})/,
                /(\w+)\s+(\d{1,2}),?\s+(\d{4})/,
                /(\d{1,2})\s+(\w+)\s+(\d{4})/
            ];
            
            // For simple month/day format like "May 11"
            if (dateStr.match(/^\w+\s+\d{1,2}$/)) {
                return new Date(`${dateStr}, ${year}`);
            }
            
            for (const format of formats) {
                const match = dateStr.match(format);
                if (match) {
                    try {
                        return new Date(dateStr);
                    } catch (e) {
                        continue;
                    }
                }
            }
            
            // Default to future date
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 7);
            return futureDate;
        }
        
        postProcess(results) {
            // Assign courses to modules
            const courseMap = {
                'ob': 'obgyn',
                'women': 'obgyn',
                'maternal': 'obgyn',
                'adult': 'adulthealth',
                'cardiac': 'adulthealth',
                'nclex': 'nclex',
                'hesi': 'nclex',
                'geronto': 'geronto',
                'gero': 'geronto',
                'elderly': 'geronto'
            };
            
            results.modules.forEach(module => {
                // Try to determine course from module title
                const lowerTitle = module.title.toLowerCase();
                for (const [keyword, course] of Object.entries(courseMap)) {
                    if (lowerTitle.includes(keyword)) {
                        module.course = course;
                        break;
                    }
                }
            });
            
            // Validate dates
            results.modules.forEach(module => {
                module.assignments.forEach(assignment => {
                    if (!assignment.date || assignment.date < new Date()) {
                        // Set a reasonable future date
                        const futureDate = new Date();
                        futureDate.setDate(futureDate.getDate() + 7);
                        assignment.date = futureDate;
                    }
                });
            });
        }
    }
    
    // Initialize parser
    const parser = new DocumentParser();
    
    // UI Functions
    function showParser() {
        document.getElementById('parser-modal').style.display = 'block';
    }
    
    function hideParser() {
        document.getElementById('parser-modal').style.display = 'none';
    }
    
    function loadTemplate() {
        const template = document.getElementById('template-select').value;
        const input = document.getElementById('document-input');
        
        const templates = {
            canvas: `Module 1: Introduction to Course
Due: May 11th
• Chapter 1-3 Reading
• Intro Video Assignment
• Module 1 Quiz`,
            syllabus: `NURS 301 - Adult Health I
Credits: 3
Module 1: Cardiovascular System
Week 1-2: Cardiac Assessment
- Read Chapters 1-3
- Complete online quiz by 5/11`,
            outline: `Week 1 (May 5-11)
Monday: OB Lecture 9:00 AM
Tuesday: Clinical 1:00 PM
Assignments:
- Read Ch. 1-3 by Sunday
- Complete dosage quiz`,
            json: JSON.stringify({
                "modules": {
                    "1": {
                        "obgyn": {
                            "title": "Module 1: Women's Health",
                            "chapters": "Chapters 1-6",
                            "keyTopics": "Women's health, Fetal development",
                            "assignments": [
                                {
                                    "text": "Chapter 1 Reading",
                                    "date": "May 11",
                                    "type": "reading",
                                    "hours": 2
                                }
                            ],
                            "classMeeting": "Monday 9:00-12:00"
                        }
                    }
                },
                "events": [
                    {
                        "title": "OB Lecture",
                        "start": "2025-05-05T09:00:00",
                        "end": "2025-05-05T12:00:00",
                        "color": "#2196F3",
                        "extendedProps": {"type": "lecture"}
                    }
                ]
            }, null, 2),
            custom: ''
        };
        
        input.value = templates[template] || '';
    }
    
    function parseDocument() {
        const input = document.getElementById('document-input').value;
        const template = document.getElementById('template-select').value || 'auto';
        const messagesDiv = document.getElementById('parser-messages');
        const resultsDiv = document.getElementById('parser-results');
        
        if (!input.trim()) {
            messagesDiv.innerHTML = '<div class="error-message">Please paste content to parse</div>';
            return;
        }
        
        messagesDiv.innerHTML = '<div class="success-message">Parsing document...</div>';
        
        // Parse the document
        parsedData = parser.parse(input, template);
        
        // Display results
        resultsDiv.innerHTML = '';
        
        if (parsedData.errors.length > 0) {
            parsedData.errors.forEach(error => {
                messagesDiv.innerHTML += `<div class="error-message">${error}</div>`;
            });
        }
        
        if (parsedData.modules.length > 0) {
            messagesDiv.innerHTML += `<div class="success-message">Found ${parsedData.modules.length} modules</div>`;
            
            parsedData.modules.forEach(module => {
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'parsed-item';
                moduleDiv.innerHTML = `
                    <h4>Module ${module.number}: ${module.title}</h4>
                    <p>Course: ${module.course || 'Unknown'}</p>
                    <p>Assignments: ${module.assignments.length}</p>
                    <ul>
                        ${module.assignments.map(a => `
                            <li>${a.text} - ${a.date.toLocaleDateString()}</li>
                        `).join('')}
                    </ul>
                `;
                resultsDiv.appendChild(moduleDiv);
            });
        }
        
        if (parsedData.events && parsedData.events.length > 0) {
            messagesDiv.innerHTML += `<div class="success-message">Found ${parsedData.events.length} calendar events</div>`;
        }
    }
    
    function importParsedDataFromUI() {
        if (!parsedData || (parsedData.modules.length === 0 && (!parsedData.events || parsedData.events.length === 0))) {
            alert('No data to import. Please parse a document first.');
            return;
        }
        
        // Convert parsed data to our format
        const importData = {
            modules: {},
            events: parsedData.events || []
        };
        
        // Convert modules
        parsedData.modules.forEach(module => {
            const week = module.number;
            if (!importData.modules[week]) {
                importData.modules[week] = {};
            }
            
            const course = module.course || 'general';
            importData.modules[week][course] = {
                title: module.title,
                chapters: module.chapters || '',
                keyTopics: module.keyTopics || '',
                assignments: module.assignments,
                classMeeting: module.classMeeting || ''
            };
        });
        
        importParsedData(importData);
    }
    
    function importParsedData(data) {
        // Import modules
        if (data.modules) {
            Object.entries(data.modules).forEach(([week, courses]) => {
                if (!semesterModules[week]) {
                    semesterModules[week] = {};
                }
                Object.assign(semesterModules[week], courses);
            });
        }
        
        // Import calendar events
        if (data.events) {
            calendarEvents = [...calendarEvents, ...data.events];
            if (calendarMonth && calendarWeek) {
                data.events.forEach(event => {
                    calendarMonth.addEvent(event);
                    calendarWeek.addEvent(event);
                });
            }
        }
        
        // Save state
        saveData();
        
        // Update UI
        changeWeek(currentWeek);
        hideParser();
        
        alert('Data imported successfully!');
    }
    
    function clearParser() {
        document.getElementById('document-input').value = '';
        document.getElementById('parser-results').innerHTML = '';
        document.getElementById('parser-messages').innerHTML = '';
        parsedData = null;
    }
    
    // Export/Import Functions
    function exportData() {
        const exportData = {
            semesterModules: semesterModules,
            completedAssignments: Array.from(completedAssignments),
            calendarEvents: calendarEvents,
            studyBlocks: studyBlocks,
            exportDate: new Date().toISOString(),
            version: '2.0'
        };
        
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const a = document.createElement('a');
        a.href = URL.createObjectURL(dataBlob);
        a.download = `nursing-schedule-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        alert('Data exported successfully! Save this file to import on another device.');
    }
    
    function showImportDialog() {
        document.getElementById('import-modal').style.display = 'block';
    }
    
    function hideImportDialog() {
        document.getElementById('import-modal').style.display = 'none';
        clearImportDialog();
    }
    
    function clearImportDialog() {
        document.getElementById('import-file').value = '';
        document.getElementById('import-preview').style.display = 'none';
        document.getElementById('import-messages').innerHTML = '';
    }
    
    // Handle file selection
    document.getElementById('import-file').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const data = JSON.parse(event.target.result);
                displayImportPreview(data);
            } catch (error) {
                document.getElementById('import-messages').innerHTML = 
                    '<div class="error-message">Invalid file format. Please select a valid JSON file.</div>';
            }
        };
        reader.readAsText(file);
    });
    
    function displayImportPreview(data) {
        const previewDiv = document.getElementById('import-preview');
        const contentDiv = document.getElementById('import-preview-content');
        
        previewDiv.style.display = 'block';
        
        let previewHtml = '<div class="parsed-item">';
        previewHtml += `<h4>Export Date: ${new Date(data.exportDate).toLocaleString()}</h4>`;
        previewHtml += `<p>Modules: ${Object.keys(data.semesterModules || {}).length} weeks</p>`;
        previewHtml += `<p>Completed Assignments: ${(data.completedAssignments || []).length}</p>`;
        previewHtml += `<p>Events: ${(data.calendarEvents || []).length}</p>`;
        previewHtml += `<p>Study Blocks: ${(data.studyBlocks || []).length}</p>`;
        previewHtml += '</div>';
        
        contentDiv.innerHTML = previewHtml;
    }
    
    function importDataFile() {
        const fileInput = document.getElementById('import-file');
        const file = fileInput.files[0];
        
        if (!file) {
            alert('Please select a file to import');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const importedData = JSON.parse(event.target.result);
                
                // Confirm import
                if (confirm('This will replace all current data. Are you sure you want to continue?')) {
                    // Import the data
                    semesterModules = importedData.semesterModules || {};
                    completedAssignments = new Set(importedData.completedAssignments || []);
                    calendarEvents = importedData.calendarEvents || [];
                    studyBlocks = importedData.studyBlocks || [];
                    
                    // Save and update UI
                    saveData();
                    changeWeek(currentWeek);
                    
                    // Update calendars
                    if (calendarMonth && calendarWeek) {
                        calendarMonth.removeAllEvents();
                        calendarWeek.removeAllEvents();
                        calendarEvents.forEach(event => {
                            calendarMonth.addEvent(event);
                            calendarWeek.addEvent(event);
                        });
                        updateCalendarWithStudyBlocks();
                    }
                    
                    hideImportDialog();
                    
                    alert('Data imported successfully!');
                }
            } catch (error) {
                alert('Error importing file: ' + error.message);
            }
        };
        reader.readAsText(file);
    }
    
    // Main UI functions
    function toggleModule(header) {
        const card = header.closest('.module-card');
        card.classList.toggle('collapsed');
    }
    
    function updateProgress(checkbox) {
        try {
            const card = checkbox.closest('.module-card');
            const checks = card.querySelectorAll('.assignment-checkbox');
            const checked = card.querySelectorAll('.assignment-checkbox:checked').length;
            const percentage = checks.length > 0 ? (checked / checks.length) * 100 : 0;
            
            const progressFill = card.querySelector('.progress-fill');
            if (progressFill) {
                progressFill.style.width = percentage + '%';
            }
            
            // Update progress text
            const progressText = card.querySelector('.progress-text');
            if (progressText) {
                progressText.textContent = `${checked}/${checks.length} completed (${percentage.toFixed(0)}%)`;
            }
            
            const courseId = card.dataset.course;
            const assignText = checkbox.closest('.assignment-item')
                                       .querySelector('.assignment-text').textContent;
            
            if (checkbox.checked) {
                completedAssignments.add(`${courseId}-${assignText}`);
            } else {
                completedAssignments.delete(`${courseId}-${assignText}`);
            }
            
            saveData();
            
        } catch (e) {
            debugCheckpoint('Error in updateProgress: ' + e.message, true);
        }
    }
    
    function markComplete(btn) {
        const card = btn.closest('.module-card');
        const nowDone = !card.classList.contains('completed');
        card.classList.toggle('completed', nowDone);
        btn.textContent = nowDone ? 'Mark Incomplete' : 'Mark Complete';
        
        card.querySelectorAll('.assignment-checkbox').forEach(cb => {
            cb.checked = nowDone;
            updateProgress(cb);
        });
    }
    
    // Study schedule generation
    function generateStudySchedule() {
        studyBlocks = [];
        const status = document.getElementById('scheduler-status');
        status.textContent = 'Generating study schedule...';
        
        const dailyMax = parseInt(document.getElementById('daily-max').value);
        const weekendMax = parseInt(document.getElementById('weekend-max').value);
        const blockDuration = parseFloat(document.getElementById('block-duration').value);
        
        const assignments = [];
        
        // Collect all incomplete assignments for current and future weeks
        for (let week = currentWeek; week <= 14; week++) {
            const weekModules = semesterModules[week] || {};
            Object.entries(weekModules).forEach(([course, module]) => {
                if (module.assignments) {
                    module.assignments.forEach(assignment => {
                        const assignId = `${course}-${assignment.text}`;
                        const isComplete = completedAssignments.has(assignId);
                        
                        if (!isComplete) {
                            const dueDate = new Date(assignment.date);
                            assignments.push({
                                ...assignment,
                                id: assignId,
                                course,
                                date: dueDate,
                                hours: assignment.hours || estimateHours(assignment.type)
                            });
                        }
                    });
                }
            });
        }
        
        // Sort by due date
        assignments.sort((a, b) => a.date - b.date);
        
        // Schedule each assignment
        assignments.forEach(assignment => {
            const daysBeforeDue = 3;
            const startDate = new Date(assignment.date);
            startDate.setDate(startDate.getDate() - daysBeforeDue);
            
            let hoursScheduled = 0;
            let currentDate = new Date(startDate);
            
            while (hoursScheduled < assignment.hours && currentDate <= assignment.date) {
                const isWeekend = currentDate.getDay() === 0 || currentDate.getDay() === 6;
                const maxToday = isWeekend ? weekendMax : dailyMax;
                
                // Check how many hours already scheduled for this day
                const existingHours = studyBlocks
                    .filter(b => b.date.toDateString() === currentDate.toDateString())
                    .reduce((sum, b) => sum + b.hours, 0);
                
                if (existingHours < maxToday) {
                    const hoursToSchedule = Math.min(
                        blockDuration,
                        assignment.hours - hoursScheduled,
                        maxToday - existingHours
                    );
                    
                    // Find an available time slot
                    const timeSlot = findTimeSlot(currentDate, hoursToSchedule);
                    
                    studyBlocks.push({
                        date: new Date(currentDate),
                        start: timeSlot.start.toISOString(),
                        end: timeSlot.end.toISOString(),
                        title: `${assignment.course.toUpperCase()}: ${assignment.text}`,
                        type: 'study',
                        hours: hoursToSchedule,
                        id: `adaptive_${Date.now()}_${Math.random()}`,
                        color: '#000000',
                        textColor: '#ffffff',
                        extendedProps: { type: 'study' }
                    });
                    
                    hoursScheduled += hoursToSchedule;
                }
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
        });
        
        status.textContent = `Scheduled ${studyBlocks.length} study blocks`;
        updateCalendarWithStudyBlocks();
        saveData();
    }
    
    function clearStudyBlocks() {
        studyBlocks = [];
        updateCalendarWithStudyBlocks();
        document.getElementById('scheduler-status').textContent = 'Study blocks cleared';
        saveData();
    }
    
    function findTimeSlot(date, hours) {
        // Find existing events on this date
        const dayStart = new Date(date);
        dayStart.setHours(0, 0, 0, 0);
        const dayEnd = new Date(date);
        dayEnd.setHours(23, 59, 59, 999);
        
        const existingEvents = calendarEvents.concat(studyBlocks)
            .filter(event => {
                const eventStart = new Date(event.start);
                return eventStart >= dayStart && eventStart <= dayEnd;
            })
            .sort((a, b) => new Date(a.start) - new Date(b.start));
        
        // Find gap in schedule
        let currentTime = new Date(date);
        currentTime.setHours(8, 0, 0, 0); // Start at 8 AM
        
        for (const event of existingEvents) {
            const eventStart = new Date(event.start);
            const eventEnd = new Date(event.end);
            
            // If there's a gap before this event
            const gap = (eventStart - currentTime) / (1000 * 60 * 60);
            if (gap >= hours) {
                const start = new Date(currentTime);
                const end = new Date(currentTime);
                end.setHours(end.getHours() + hours);
                return { start, end };
            }
            
            currentTime = eventEnd;
        }
        
        // Check if there's time after all events
        const endOfDay = new Date(date);
        endOfDay.setHours(22, 0, 0, 0); // End at 10 PM
        
        if (currentTime < endOfDay) {
            const start = new Date(currentTime);
            const end = new Date(currentTime);
            end.setHours(end.getHours() + hours);
            return { start, end };
        }
        
        // Default time slot if no gaps found
        const start = new Date(date);
        start.setHours(19, 0, 0, 0); // 7 PM default
        const end = new Date(start);
        end.setHours(end.getHours() + hours);
        return { start, end };
    }
    
    function updateCalendarWithStudyBlocks() {
        if (!calendarMonth || !calendarWeek) {
            debugCheckpoint('Calendars not initialized', true);
            return;
        }
        
        // Remove existing study blocks
        const allEvents = calendarMonth.getEvents();
        allEvents.forEach(event => {
            if (event.id && event.id.startsWith('adaptive_')) {
                event.remove();
            }
        });
        
        // Add new study blocks
        studyBlocks.forEach(block => {
            calendarMonth.addEvent(block);
            calendarWeek.addEvent(block);
        });
    }
    
    function estimateHours(type) {
        const estimates = {
            'reading': 2,
            'video': 0.5,
            'quiz': 1.5,
            'exam': 3,
            'assignment': 2.5,
            'vsim': 2,
            'activity': 1,
            'prep': 1,
            'remediation': 2,
            'presentation': 2,
            'simulation': 3
        };
        return estimates[type] || 1.5;
    }
    
    function generateModuleCards(week) {
        debugCheckpoint(`Generating module cards for week ${week}`);
        const container = document.getElementById('module-cards');
        container.innerHTML = '';
        
        const weekModules = semesterModules[week];
        
        if (!weekModules || Object.keys(weekModules).length === 0) {
            // Show empty state
            container.innerHTML = `
                <div class="welcome-card">
                    <h2>Welcome to Your Nursing Schedule Dashboard</h2>
                    <p style="margin: 20px 0; color: #666;">No course data found. Get started by importing your course documents.</p>
                    <button class="btn btn-primary" onclick="showParser()" style="padding: 12px 24px; font-size: 16px;">
                        Import Course Documents
                    </button>
                    <div style="margin-top: 30px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                        <h4>How to get started:</h4>
                        <ol style="color: #666; line-height: 1.8;">
                            <li>Click "Import Course Documents" button above</li>
                            <li>Select a template or paste your syllabus/course outline</li>
                            <li>Click "Parse Document" to extract assignments and dates</li>
                            <li>Review the parsed results and click "Import to Schedule"</li>
                        </ol>
                        <p style="margin-top: 20px; color: #888;">The parser can recognize modules, assignments, due dates, and course information from various formats including Canvas, syllabi, and course outlines.</p>
                        
                        <h4 style="margin-top: 30px;">Quick Start Templates:</h4>
                        <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; justify-content: center;">
                            <button class="btn btn-secondary" onclick="loadSampleData('nursing')" style="padding: 8px 16px;">
                                Load Sample Nursing Schedule
                            </button>
                            <button class="btn btn-secondary" onclick="loadSampleData('minimal')" style="padding: 8px 16px;">
                                Load Minimal Example
                            </button>
                        </div>
                    </div>
                </div>
            `;
            return;
        }
        
        for (const [course, mod] of Object.entries(weekModules)) {
            if (!mod || !mod.title) continue;
            
            const card = document.createElement('div');
            card.className = 'module-card';
            card.dataset.course = course;
            
            const assignmentItems = (mod.assignments || []).map((a, index) => `
                <div class="assignment-item">
                    <input type="checkbox" class="assignment-checkbox" id="${course}-${index}">
                    <span class="assignment-text">${a.text}</span>
                    <span class="assignment-date">${a.date}</span>
                </div>`).join('');
            
            card.innerHTML = `
            <div class="module-header ${course}-header" onclick="toggleModule(this)">
                <div><div class="module-title">${mod.title}</div></div>
                <div style="display:flex;align-items:center;gap:10px;">
                    <span class="module-status">Current</span>
                    <span class="collapse-icon">▼</span>
                </div>
            </div>
            <div class="module-content">
                <div class="module-info">${mod.chapters}</div>
                <div class="key-topics"><h4>Key Topics:</h4><p>${mod.keyTopics}</p></div>
                <div class="assignments">${assignmentItems}</div>
                <div class="progress-bar"><div class="progress-fill"></div></div>
                <div class="progress-text">0/${mod.assignments.length} completed (0%)</div>
                ${mod.classMeeting ? `<div class="class-info"><strong>Class Meeting:</strong> ${mod.classMeeting}</div>` : ''}
                <div class="action-buttons">
                    <a href="#" class="btn btn-primary" onclick="event.preventDefault()">View All Resources</a>
                    <button class="btn btn-secondary" onclick="markComplete(this)">
                        Mark Complete
                    </button>
                </div>
            </div>`;
            container.appendChild(card);
        }
        
        // Add event listeners after adding to DOM
        container.querySelectorAll('.assignment-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                updateProgress(this);
            });
        });
        
        loadCheckboxStates();
    }
    
    function generateWeekSchedule(week = 1) {
        debugCheckpoint(`Generating list view for week ${week}`);
        const container = document.getElementById('week-schedule');
        const weekStart = getWeekStartDate(week);
        const days = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
        
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);
        
        container.innerHTML =
            days.map((d,i) => {
                const dateObj = new Date(weekStart);
                dateObj.setDate(dateObj.getDate()+i);
                const dateISO = dateObj.toISOString().split('T')[0];
                const thisDay = calendarEvents
                    .filter(ev => ev.start.split('T')[0] === dateISO)
                    .sort((a,b)=>new Date(a.start)-new Date(b.start));
                
                const studyBlocksForDay = studyBlocks
                    .filter(block => block.start.split('T')[0] === dateISO)
                    .sort((a,b) => new Date(a.start) - new Date(b.start));
                
                const allDayEvents = [...thisDay, ...studyBlocksForDay].sort((a,b) => new Date(a.start) - new Date(b.start));
                
                return `
                <div class="day-section">
                    <div class="day-header">${d} – ${dateObj.toLocaleDateString('en-US',{month:'short',day:'numeric'})}</div>
                    ${allDayEvents.length
                        ? allDayEvents.map(ev=>{
                            const s = new Date(ev.start).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});
                            const e = new Date(ev.end  ).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});
                            return `<div class="time-slot"><span class="time">${s}-${e}</span>
                                     <div class="event ${ev.extendedProps.type}">${ev.title}</div></div>`;
                          }).join('')
                        : '<div class="time-slot"><span class="time">No scheduled events</span></div>'}
                </div>`; 
            }).join('');
    }
    
    function filterByCourse(course) {
        document.querySelectorAll('.module-card').forEach(c=>{
            c.style.display = (course==='all'||c.dataset.course===course)?'block':'none';
        });
    }
    
    function loadCheckboxStates() {
        debugCheckpoint('Loading checkbox states');
        document.querySelectorAll('.module-card').forEach(card=>{
            const course = card.dataset.course;
            card.querySelectorAll('.assignment-item').forEach(item=>{
                const cb = item.querySelector('.assignment-checkbox');
                const txt = item.querySelector('.assignment-text').textContent;
                const assignId = `${course}-${txt}`;
                cb.checked = completedAssignments.has(assignId);
            });
            // Update progress after loading states
            const firstCheckbox = card.querySelector('.assignment-checkbox');
            if (firstCheckbox) {
                updateProgress(firstCheckbox);
            }
        });
    }
    
    function changeWeek(week) {
        debugCheckpoint(`Changing to week ${week}`);
        currentWeek = parseInt(week);
        document.getElementById('week-number').textContent = week;
        document.getElementById('current-week').textContent = `Week ${week}`;
        document.getElementById('week-selector').value = week;
        generateModuleCards(week);
        generateWeekSchedule(week);
        updateWeekView(week);
    }
    
    function updateWeekView(week) {
        const weekStart = getWeekStartDate(week);
        if (calendarMonth) calendarMonth.gotoDate(weekStart);
        if (calendarWeek) calendarWeek.gotoDate(weekStart);
    }
    
    function getWeekStartDate(weekNum) {
        const firstMonday = new Date('2025-05-05');
        const result = new Date(firstMonday);
        result.setDate(firstMonday.getDate() + (weekNum - 1) * 7);
        return result;
    }
    
    // Sample data loader
    function loadSampleData(type) {
        let sampleData;
        
        if (type === 'nursing') {
            sampleData = {
                modules: {
                    "1": {
                        "obgyn": {
                            "title": "Module 1: Women's Health",
                            "chapters": "Chapters 1-6",
                            "keyTopics": "Women's health, Fetal development",
                            "assignments": [
                                { text: "Chapter 1 Reading", date: "May 11", type: "reading", hours: 2 },
                                { text: "Module 1 Quiz", date: "May 11", type: "quiz", hours: 1.5 }
                            ],
                            "classMeeting": "Monday 9:00-12:00"
                        }
                    }
                },
                events: [
                    {
                        title: "OB Lecture",
                        start: "2025-05-05T09:00:00",
                        end: "2025-05-05T12:00:00",
                        color: "#2196F3",
                        extendedProps: { type: "lecture" }
                    },
                    {
                        title: "OB Clinical",
                        start: "2025-05-06T07:00:00",
                        end: "2025-05-06T15:00:00",
                        color: "#4CAF50", 
                        extendedProps: { type: "clinical" }
                    }
                ]
            };
        } else {
            sampleData = {
                modules: {
                    "1": {
                        "sample": {
                            "title": "Sample Module",
                            "chapters": "Introduction",
                            "keyTopics": "Getting started",
                            "assignments": [
                                { text: "Read Introduction", date: "May 10", type: "reading", hours: 1 }
                            ],
                            "classMeeting": "Monday 10:00-11:00"
                        }
                    }
                },
                events: []
            };
        }
        
        importParsedData(sampleData);
    }
    
    // Save/Load functions
    function saveData() {
        const data = {
            semesterModules,
            calendarEvents,
            completedAssignments: Array.from(completedAssignments),
            studyBlocks,
            currentWeek,
            savedDate: new Date().toISOString()
        };
        localStorage.setItem('nursingSchedulerData', JSON.stringify(data));
    }
    
    function loadSavedData() {
        const saved = localStorage.getItem('nursingSchedulerData');
        if (saved) {
            try {
                const data = JSON.parse(saved);
                semesterModules = data.semesterModules || {};
                calendarEvents = data.calendarEvents || [];
                completedAssignments = new Set(data.completedAssignments || []);
                studyBlocks = data.studyBlocks || [];
                currentWeek = data.currentWeek || 1;
                debugCheckpoint('Loaded saved data', false, {
                    modules: Object.keys(semesterModules).length,
                    events: calendarEvents.length,
                    savedDate: data.savedDate
                });
            } catch (e) {
                debugCheckpoint('Error loading saved data', true, e);
            }
        }
    }
    
    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
        debugCheckpoint('DOM loaded, initializing application');
        
        // Load saved data
        loadSavedData();
        
        // Initialize calendars
        try {
            const calendarElMonth = document.getElementById('calendar-month');
            const calendarElWeek = document.getElementById('calendar-week');
            
            if (!calendarElMonth || !calendarElWeek) {
                debugCheckpoint('Calendar elements not found', true);
                return;
            }
            
            // Initialize month calendar
            calendarMonth = new FullCalendar.Calendar(calendarElMonth, {
                initialView: 'dayGridMonth',
                initialDate: '2025-05-05',
                headerToolbar: { left:'prev,next today', center:'title', right:'' },
                events: calendarEvents,
                eventClassNames: a => [a.event.extendedProps.type],
                eventTimeFormat: { hour:'numeric', minute:'2-digit', meridiem:'short' },
                eventClick: i => alert(
                    `${i.event.title}\n${i.event.start.toLocaleTimeString()} – ` +
                    `${i.event.end.toLocaleTimeString()}`
                )
            });
            
            // Initialize week calendar
            calendarWeek = new FullCalendar.Calendar(calendarElWeek, {
                initialView: 'timeGridWeek',
                initialDate: '2025-05-05',
                headerToolbar: { left:'prev,next today', center:'title', right:'' },
                events: calendarEvents,
                eventClassNames: a => [a.event.extendedProps.type],
                eventTimeFormat: { hour:'numeric', minute:'2-digit', meridiem:'short' },
                eventClick: i => alert(
                    `${i.event.title}\n${i.event.start.toLocaleTimeString()} – ` +
                    `${i.event.end.toLocaleTimeString()}`
                )
            });
            
            calendarMonth.render();
            calendarWeek.render();
            debugCheckpoint('Calendars rendered successfully');
            
            // Add study blocks to calendars
            updateCalendarWithStudyBlocks();
            
        } catch (error) {
            debugCheckpoint('Error creating calendars: ' + error.message, true);
            return;
        }
        
        // Tab handler
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', e => {
                const view = e.currentTarget.dataset.view;
                
                // Update tab styles
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                e.currentTarget.classList.add('active');
                
                // Update view visibility
                document.querySelectorAll('.calendar-view').forEach(v => v.classList.remove('active'));
                document.getElementById(`${view}-view`).classList.add('active');
                
                if (view === 'list') {
                    generateWeekSchedule(currentWeek);
                }
            });
        });
        
        // Calculate current week
        const today = new Date();
        const semesterStart = new Date('2025-05-05');
        const semesterEnd = new Date('2025-08-10');
        
        if (today >= semesterStart && today <= semesterEnd) {
            const daysDiff = Math.floor((today - semesterStart) / (1000 * 60 * 60 * 24));
            currentWeek = Math.floor(daysDiff / 7) + 1;
            currentWeek = Math.max(1, Math.min(14, currentWeek));
        }
        
        // Initialize the UI
        changeWeek(currentWeek);
        
        debugCheckpoint('Application initialized successfully', false, {
            currentWeek,
            modulesLoaded: Object.keys(semesterModules).length,
            eventsLoaded: calendarEvents.length
        });
    });
</script>
</body>
</html>
Improve
Explain